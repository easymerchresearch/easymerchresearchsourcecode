!function(){"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36{Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.5249.119 Safari/537.36{Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; AS; rv:11.0) like Gecko{Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Edge/12.246{Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0{Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36{Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36{Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; AS; rv:11.0) like Gecko".split("{");let e=null,t=null,r=null,n=null,o="en";async function i(){try{const a=await async function(){try{const a=await m();if(a)return new Promise((b,e)=>{const t=chrome.runtime.connect({name:"retrieveSettings"});t.postMessage({action:"retrieveSettings",tabId:a}),t.onMessage.addListener(e=>{"success"===e.status&&e.message?b(e.message):b(null),t.disconnect()}),t.onDisconnect.addListener(()=>{chrome.runtime.lastError&&e(Error("Disconnected due to an error"))})});throw Error("tabId is undefined")}catch(e){return null}}();let b=a?a.refresh:0,e=!1;for(;!e&&b<3;)try{const t=document.querySelector("#nav-packard-glow-loc-icon");if(e=t&&null!==t.offsetParent,e)break;return b++,a.refresh=b,await g(a),void location.reload(!0)}catch(e){}return e||(a.refresh=0,await g(a)),e}catch(e){return!1}}async function s(a){return chrome.runtime.getURL(`assets/images/${a}`)}function c(a,b="N/A"){return a&&null!==a?a:b}document.addEventListener("DOMContentLoaded",async()=>{try{const a=await async function(){try{const a=await m();if(a)return new Promise((b,e)=>{const t=chrome.runtime.connect({name:"UI"});t.postMessage({action:"getUI",tabId:a}),t.onMessage.addListener(e=>{"success"===e.status&&e.message?b(e.message):b(null),t.disconnect()}),t.onDisconnect.addListener(()=>{chrome.runtime.lastError&&e(Error("Disconnected due to an error"))})});throw Error("tabId is undefined")}catch(e){return null}}();a&&(r=a),await(a=>new Promise(b=>setTimeout(b,a)))(100),n=navigator.userAgent}catch(e){}}),async function(){const a=window.location.href.match(/https?:\/\/?(www\.?amazon\.(com|es|fr|it|de|co\.uk))/);a&&(e=`${a[1]}/`,/^https?:\/\//i.test(e)||(e=`https://${e}`))}(),window.addEventListener("load",function(){r&&r.isEnabled&&(i()?async function(){await new Promise((a,b)=>{chrome.runtime.sendMessage({action:"gls"},e=>chrome.runtime.lastError?b(new Error(chrome.runtime.lastError.message)):void a(e?.active||!1))})&&(t||=await s("loading.gif"),o=(document.documentElement.lang||"en").slice(0,2).toLowerCase(),async function(){try{await async function(){const e=document.querySelector('#desktop_buybox[data-feature-name="desktop_buybox"]');if(e){t||=await s("loading.gif");const r=document.createElement("div");r.classList.add("emr_details_container"),r.innerHTML=`\n<p>Date: <b class="emr-date"><img src='${t}'/></b></p>\n<p>Rank(BSR): <b class="emr-bsr"><img src='${t}'/></b></p>\n<p>Asin: <b class="emr-asin"><img src='${t}'/></b></p>\n<p>Design: <b class="emr-download"><img src='${t}'/></b></p>\n`,e.parentElement?.insertBefore(r,e);let n=new URL(window.location.href);/^https?:\/\//i.test(n.href)||(n=new URL(`https://${n.href}?language=en_GB`)),async function(a){let b=document;b&&"undefined"!==b&&async function(a,b){try{let e=function(e,b){try{let a=e,t=`${b}`;/^https?:\/\//i.test(t)||(t=`https://${t}`);let r=c(null),n=c(function(a){try{return a.querySelector("#imgTagWrapperId img")?.getAttribute("src").trim().replace(/[\u200E\u200F\u202A-\u202E\u2066-\u2069\u200B\u200C\u2028\u2029]/g,"")||null}catch(e){}return null}(a)),o=c(u(a,"Date")),i=c(u(a,"Best Sellers")),s=c(u(a,"Asin")),l=c(null),d=c(null);return new p(r,t,n,o,i,s,l,d,"N/A","N/A","N/A")}catch(e){}return null}(a,b);if(!e)return;const t=document.querySelector(".emr_details_container");if(t){const r=t.querySelector(".emr-date"),n=t.querySelector(".emr-bsr"),o=t.querySelector(".emr-asin"),i=t.querySelector(".emr-download");r&&(r.textContent=function(e){try{if(!e||e.includes("N/A"))return e;const t={Januar:"January",Februar:"February","März":"March",April:"April",Mai:"May",Juni:"June",Juli:"July",August:"August",September:"September",Oktober:"October",November:"November",Dezember:"December",janvier:"January","février":"February",mars:"March",avril:"April",mai:"May",juin:"June",juillet:"July","août":"August",septembre:"September",octobre:"October",novembre:"November","décembre":"December",enero:"January",febrero:"February",marzo:"March",abril:"April",mayo:"May",junio:"June",julio:"July",agosto:"August",septiembre:"September",octubre:"October",noviembre:"November",diciembre:"December",gennaio:"January",febbraio:"February",marzo:"March",aprile:"April",maggio:"May",giugno:"June",luglio:"July",agosto:"August",settembre:"September",ottobre:"October",novembre:"November",dicembre:"December","січня":"January","лютого":"February","березня":"March","квітня":"April","травня":"May","червня":"June","липня":"July","серпня":"August","вересня":"September","жовтня":"October","листопада":"November","грудня":"December"};for(const[r,n]of Object.entries(t)){const t=new RegExp(`\\b${r}\\b`,"i");if(t.test(e)){e=e.replace(t,n);break}}/^\w+ \d{1,2} \d{4}$/.test(e)&&(e=e.replace(/^(\w+ \d{1,2}) (\d{4})$/,"$1, $2"));const r=new Date(e);if(isNaN(r))throw new RangeError("Invalid Date");return new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(r)}catch(e){return"N/A"}}(e.date)),n&&(n.textContent=function(a){return"string"!=typeof a||""===a.trim()||isNaN(a.trim())||isNaN(a)||null==a?"N/A":"#"+Number(a).toLocaleString()}(e.bsr)),o&&(o.textContent=e.asin),i&&(i.textContent="Download",async function(e,a){e.addEventListener("click",async function(){const b=a.split("https://m.media-amazon.com/images/I/")[1];var e,t;if(!b)return void alert("Invalid Image URL");{const a=b.split("%7C");e=a.find(a=>a.endsWith(".png")||a.endsWith(".jpg")),t="https://m.media-amazon.com/images/I/"+e}if(document.querySelector(".emr_popup"))return;const r=document.createElement("div");r.classList.add("emr_popup","emr-glow-border");const n=document.createElement("button");n.classList.add("emr-popup-close","emr-closer"),n.textContent="X",n.onclick=()=>{r.remove()};const o=document.createElement("div");o.className="emr-popup-right",o.innerHTML='\n<label for="emr-bgColor">Background Color:</label>\n<input type="color" id="emr-bgColor" value="#000000">\n<div class="emr-color-grid" id="emr-colorGrid">\n\x3c!-- Color buttons will be generated by JS --\x3e\n</div>\n\n<div id="emr-selectedColor" style="display:none">No color selected</div>\n<label for="emr-scale">Scale (1–100%):</label>\n<input type="range" id="emr-scale" min="1" max="100" value="10"/>\n<input type="button" id="emr-downl"  value="Download"/>\n';const i=document.createElement("div");i.className="emr-popup-left",i.id="emr-imageArea",i.innerHTML=`\n<img id="emr-popupImage" src="${t}" alt="Preview Image">\n`,r.appendChild(n),r.appendChild(i),r.appendChild(o),document.body.appendChild(r),o.querySelector("#emr-bgColor").addEventListener("change",a=>{i.style.backgroundColor=a.target.value});const s=document.getElementById("emr-colorGrid");document.getElementById("emr-selectedColor"),[{name:"White",hex:"#FFFFFF"},{name:"Navy",hex:"#1A1F71"},{name:"Dark Heather",hex:"#4B4F56"},{name:"Orange",hex:"#FFA500"},{name:"Pink",hex:"#FFC0CB"},{name:"Purple",hex:"#800080"}].forEach(a=>{const b=document.createElement("div");b.className="emr-color-btn",b.style.backgroundColor=a.hex,b.dataset.color=a.name,b.title=a.name,b.addEventListener("click",()=>{document.querySelectorAll(".emr-color-btn").forEach(a=>a.classList.remove("emr-selected")),b.classList.add("emr-selected"),i.style.backgroundColor=a.hex}),s.appendChild(b)}),o.querySelector("#emr-downl").addEventListener("click",async()=>{if(t)try{const a=await fetch(t),b=await a.blob(),r=document.createElement("a");r.href=URL.createObjectURL(b),r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>URL.revokeObjectURL(r.href),100)}catch(e){alert("Failed to download the image.")}else alert("Invalid URL")}),o.querySelector("#emr-scale").addEventListener("input",a=>{const b=a.target.value;i.querySelector("img").style.transform=`scale(${b/10})`});let c=!1,l=0,u=0,d=0,m=0;i.addEventListener("click",a=>{c=!c,i.style.cursor=c?"grabbing":"default",c&&(l=a.pageX,u=a.pageY,d=i.scrollLeft,m=i.scrollTop)}),i.addEventListener("mousemove",a=>{if(!c)return;const b=a.pageX-l,e=a.pageY-u;i.scrollLeft=d-b,i.scrollTop=m-e})})}(i,e.img))}e=null}catch(e){}}(b,a)}(n)}}()}catch(e){}}())}():i()||alert("Refresh the and check out the zip code"))});const l={en:{Date:["Date First Available","Publication date","Release Date","Date first listed on Amazon"],Manufacturer:["Manufacturer"],"Best Sellers":["Best Sellers Rank","Amazon Bestsellers Rank"],Asin:["Asin","ISBN-10"]},de:{Date:["Im Angebot von Amazon","Erscheinungstermin"],Manufacturer:["Hersteller"],"Best Sellers":["Bestseller-Rang"],Asin:["Asin","ISBN-10"]},fr:{Date:["Date de mise en ligne sur Amazon","Date de publication"],Manufacturer:["Fabricant"],"Best Sellers":["Classement des meilleures ventes d'Amazon"],Asin:["Asin","ISBN-10"]},es:{Date:["Producto en Amazon","Fecha de","Disponibile su Amazon","Fecha de disponibilidad en Amazon"],Manufacturer:["Fabricante"],"Best Sellers":["Clasificación en los más vendidos"],Asin:["Asin","ISBN-10"]},it:{Date:["Disponibile su Amazon","Data di pubblicazione"],Manufacturer:["Produttore"],"Best Sellers":["Posizione nella classifica Bestseller"],Asin:["Asin","ISBN-10"]}};function u(e,t){try{const r=e.querySelector("#detailBulletsWrapper_feature_div"),n=l[o]?.[t]||[],i=e=>{e=e.toLowerCase();for(let t=0;t<n.length;t++)if(e.includes(n[t].toLowerCase()))return!0;return e.includes(t.toLowerCase())},s=e=>{if(!e)return null;if("Best Sellers"===t){const t=e.match(/^[^\d]*([\d\u00A0\u202F.,']+)/);return t?t[1].replace(/[\u00A0\u202F.,']/g,""):null}return e.replace(/,/g,"").replace(/\s+/g," ").trim()};if(r){const e=r.querySelectorAll("ul li");for(let t=0;t<e.length;t++){const r=e[t].innerText.trim();if(!i(r))continue;const n=r.split(":")[1];if(n)return d(s(n))}}const c=e.querySelector("#audibleProductDetails")||e.querySelector("#productDetails_feature_div");if(c){const e=c.querySelectorAll("tbody tr");for(let t=0;t<e.length;t++){const r=e[t];if(!i(r.innerText.trim()))continue;const n=r.querySelector("td");if(n)return d(s(n.innerText))}}return null}catch(e){return null}}function d(a){return a?a.replace(/,/g,"").replace(/[\u200E\u200F\u202A-\u202E\u2066-\u2069\u200B\u200C\u2028\u2029]/g,"").normalize("NFC").trim():null}async function m(){let a=0;for(;a<3;)try{return await new Promise((b,e)=>{const t=chrome.runtime.connect({name:"activeTabId"});t.postMessage({action:"getActiveTabId"}),t.onMessage.addListener(r=>{r&&void 0!==r.tabId?b(r.tabId):e("Tab ID not found"),t.disconnect()}),t.onDisconnect.addListener(()=>{chrome.runtime.lastError&&e(chrome.runtime.lastError.message)})})}catch(e){if(a++,a>=3)break;await new Promise(e=>setTimeout(e,500))}return null}async function g(a,b){let e=0,t=!1;for(;e<3;)try{if(!a)break;const e=await m();if(!e)throw Error("Tab ID retrieval failed.");const r=chrome.runtime.connect({name:"saveSettings"});r.postMessage({action:"saveSettings",data:a,tabId:e});const n=setTimeout(()=>{r.disconnect()},3e4),o=await new Promise((e,t)=>{r.onMessage.addListener(t=>{clearTimeout(n),e(t),r.disconnect()}),r.onDisconnect.addListener(()=>{chrome.runtime.lastError?t(Error(`Disconnected due to an error: ${chrome.runtime.lastError.message}`)):t(Error("Port disconnected without a response."))})});if("success"===o.status){!t&&b&&(closeTabAndOpenNew(a.dmUrl),t=!0);break}throw Error(`Settings storage failed: ${o.message}`)}catch(t){if(e++,e>=3)break;await new Promise(e=>setTimeout(e,1e3))}}class p{constructor(e,t,r,a,n,o,i,s,c,l,u){this.title=this.cleanString(e),this.date=this.cleanString(a),this.asin=this.cleanString(o),this.bsr=this.cleanString(n),this.ahref=this.cleanString(t),this.img=this.cleanString(r),this.price=this.cleanString(i),this.brand=this.cleanString(s),this.competition=this.cleanString(c),this.reviews=this.cleanString(l),this.ratings=this.cleanString(u)}cleanString(e){return"string"==typeof e?e.replace(/[\u200E\u200F\u202A-\u202E\u2066-\u2069\u200B\u200C\u2028\u2029]/g,"").normalize("NFC"):e}}}();