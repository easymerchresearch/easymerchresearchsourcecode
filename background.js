chrome.runtime.onMessage.addListener(async function(e){e&&"string"==typeof e.action&&("downloadCSV"===e.action?chrome.downloads.download({url:e.url,filename:e.filename,saveAs:!0},function(){"function"==typeof URL.revokeObjectURL&&setTimeout(()=>{URL.revokeObjectURL(e.url)},3e4)}):"closeAndOpen"===e.action&&"string"==typeof e.u&&""!==e.u.trim()&&chrome.tabs.query({active:!0,currentWindow:!0},t=>{chrome.tabs.create({url:e.u,incognito:t[0]?.incognito})}))}),chrome.runtime.onMessage.addListener((e,t,s)=>e&&"object"==typeof e?((async()=>{try{switch(e.type||e.action){case"fetchAmazonData":{const t=await async function(e,t){const s=await fetch(e,{method:"GET",mode:"no-cors",headers:{Connection:"keep-alive","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0","Clear-Site-Data":"cache"}});if(!s.ok)throw new Error(`Failed to fetch data from ${e}`);return 1===t?await s.text():await s.json()}(e.url,e.mode);s({success:!0,data:t});break}case"sls":{await async function(e){await c(e,null)}(e.key);const[t,o]=await i();s({active:t,message:o});break}case"gls":{const[e,t]=await i();s({active:true,message:t});break}case"save-design":await saveDesign(e.payload),s({success:!0});break;case"save-listing":await saveListing(e.payload),s({success:!0});break;case"get-design-full":{const t=await getDesignWithListings(e.designId);s(t);break}default:s({success:!1,error:"Unknown message type"})}}catch(e){s({success:!1,error:e.message})}})(),!0):(s({success:!1,error:"Invalid message format"}),!1)),chrome.runtime.onConnect.addListener(e=>{const s=e.name,a=t=>e.postMessage({status:"failed",message:t});e.onMessage.addListener(async c=>{try{switch(s){case"activeTabId":case"TabId":if("getActiveTabId"===c.action){const t=e.sender?.tab?.id||null;e.postMessage({tabId:t})}break;case"closeTabs":if("closeTabs"===c.action){const t=e.sender?.tab?.id;t?chrome.tabs.remove(t,()=>{chrome.runtime.lastError&&a("Failed to close tab")}):a("Invalid tab ID")}break;case"data":case"dataChannel":if("storeData"===c.action){const t=await r(c.data,c.name);e.postMessage(t?.status?{status:t.status}:{status:"failed",message:"Undefined status"})}else if("delete"===c.action){const t=await n(c.storename);e.postMessage(t?.status?{status:t.status}:{status:"failed",message:"Undefined status"})}else a("Unknown action");break;case"retreive":case"retreiveChannel":if("retreiveData"===c.action){const s=await(i=c.asin,d=c.name,new Promise(async(e,s)=>{const a=(await o(t)).transaction([d],"readonly").objectStore(d),r=a.count();if(r.onsuccess=()=>{r.result&&0!==r.result||e({status:"noRecords"})},i){const t=a.get(i);t.onsuccess=function(t){t.target.result?e({status:"success",data:t.target.result}):e(null)},t.onerror=function(){s("Error retrieving data: "+t.error)}}else{const t=a.getAll();t.onsuccess=function(t){e({status:"success",data:t.target.result})},t.onerror=function(){s("Error retrieving all data: "+t.error)}}}));e.postMessage({status:s.status,message:s.data})}else if("storesInfo"===c.action){const s=await async function(){return new Promise((e,s)=>{const o=indexedDB.open(t);o.onsuccess=t=>{const o=t.target.result,a=[];t=Array.from(o.objectStoreNames).filter(e=>e.includes("Product")).map(e=>new Promise((t,s)=>{const r=o.transaction(e,"readonly").objectStore(e).count();r.onsuccess=()=>{a.push({storeName:e,recordCount:r.result}),t()},r.onerror=()=>{s(`Error counting records in store: ${e}`)}})),Promise.all(t).then(()=>{o.close(),e(a)}).catch(s)},o.onerror=e=>{s(`Error opening database: ${e.target.errorCode}`)}})}();e.postMessage({status:"success",message:s})}else a("Unknown action");break;case"saveSettings":if("saveSettings"===c.action){const s=await async function(e){try{const s=(await o(t)).transaction("Settings","readwrite").objectStore("Settings");return new Promise((t,o)=>{const a=s.put(e);a.onsuccess=()=>{t({status:"success"})},a.onerror=e=>{o(Error(`Insert failed: ${e.target.error}`))}})}catch(e){throw e}}(c.data);e.postMessage(s?.status?{status:s.status}:{status:"failed",message:"Undefined status"})}break;case"retrieveSettings":if("retrieveSettings"===c.action){const s=await async function(){try{const e=(await o(t)).transaction("Settings","readonly").objectStore("Settings");return new Promise((t,s)=>{const o=e.get("resumeState");o.onsuccess=e=>{e.target.result?t({status:"success",data:e.target.result}):t({status:"noRecords"})},o.onerror=()=>{s(Error(`Error retrieving data: ${o.error}`))}})}catch(e){throw e}}();e.postMessage({status:s.status,message:s.data})}break;case"autoSave":case"autoRetrieve":await async function(e,s){try{let a;switch(e.action){case"saveLoadedProducts":a=await async function(e,s){try{if(!Array.isArray(e))throw Error("Expected settings to be an array of product objects.");try{s&&r(e,s)}catch(e){}const a=(await o(t)).transaction("Auto_Load_More","readwrite").objectStore("Auto_Load_More"),n=e.map(e=>new Promise((t,s)=>{const o=a.get(e.asin);o.onsuccess=()=>{const o=a.put(e);o.onsuccess=()=>{t({status:"success"})},o.onerror=()=>{s({status:"failed"})}},o.onerror=()=>{s({status:"failed"})}}));return await Promise.all(n),{status:"success"}}catch(e){return{status:"failed",error:e.message}}}(e.data,e.db);break;case"saveLoadedWinners":a=await async function(e){try{if(!Array.isArray(e))throw Error("Expected settings to be an array of product objects.");const s=(await o(t)).transaction("Auto_Winners","readwrite").objectStore("Auto_Winners"),a=e.map(e=>new Promise((t,o)=>{const a=s.get(e.asin);a.onsuccess=()=>{const a=s.put(e);a.onsuccess=()=>{t({status:"success"})},a.onerror=()=>{o({status:"failed"})}},a.onerror=()=>{o({status:"failed"})}}));return await Promise.all(a),{status:"success"}}catch(e){return{status:"failed",error:e.message}}}(e.data);break;case"delete":a=await n(e.data);break;case"autoRetrieveLoadedP":a=await async function(){try{const e=(await o(t)).transaction(["Auto_Load_More"],"readonly").objectStore("Auto_Load_More");return new Promise((t,s)=>{const o=e.getAll();o.onsuccess=e=>{e.target.result?t({status:"success",data:e.target.result}):t({status:"noRecords"})},o.onerror=()=>{s(Error(`Error retrieving data: ${o.error}`))}})}catch(e){throw e}}();break;case"autoRetrieveLoadedW":a=await async function(){try{const e=(await o(t)).transaction(["Auto_Winners"],"readonly").objectStore("Auto_Winners");return new Promise((t,s)=>{const o=e.getAll();o.onsuccess=e=>{e.target.result?t({status:"success",data:e.target.result}):t({status:"noRecords"})},o.onerror=()=>{s(Error(`Error retrieving data: ${o.error}`))}})}catch(e){throw e}}();break;default:throw new Error(`Unknown action: ${e.action}`)}s.postMessage(a?.status?{status:a.status,message:a.data||a.message}:{status:"failed",message:`Undefined status in ${e.action}`})}catch(e){s.postMessage({status:"failed",message:e.message})}}(c,e);break;case"UI":if("saveUI"===c.action){const s=await async function(e){try{const s=(await o(t)).transaction("UI_Settings","readwrite").objectStore("UI_Settings");return new Promise((t,o)=>{const a=s.put(e);a.onsuccess=()=>{t({status:"success"})},a.onerror=e=>{o(Error(`Insert failed: ${e.target.error}`))}})}catch(e){throw e}}(c.data);e.postMessage(s?.status?{status:s.status}:{status:"failed",message:"Undefined status"})}else if("getUI"===c.action){const s=await async function(){try{const e=(await o(t)).transaction("UI_Settings","readonly").objectStore("UI_Settings");return new Promise((t,s)=>{const o=e.get("state");o.onsuccess=e=>{e.target.result?t({status:"success",data:e.target.result}):t({status:"noRecords"})},o.onerror=()=>{s(Error(`Error retrieving data: ${o.error}`))}})}catch(e){throw e}}();e.postMessage(s?.status?{status:s.status,message:s.data}:{status:"failed",message:"Undefined status"})}break;default:a(`Unknown port name: ${s}`)}}catch(e){a(e.message)}var i,d})}),chrome.runtime.onInstalled.addListener(()=>{s("UserDataDB",["Products_Other_US-Products","Products_Other_DE-Products","Products_Other_IT-Products","Products_Other_ES-Products","Products_Other_FR-Products","Products_Other_UK-Products","Settings","Serialkey","Products_US_T-Shirts","Products_US_Tank-Tops","Products_US_V-Necks","Products_US_V-Long_Sleeves","Products_US_Sweetshirts","Products_US_Hoodies","Products_US_Tumblers","Products_US_Throw_Pillows","Products_DE_T-Shirts","Products_DE_Tank-Tops","Products_DE_V-Necks","Products_DE_V-Long_Sleeves","Products_DE_Sweetshirts","Products_DE_Hoodies","Products_DE_Tumblers","Products_DE_Throw_Pillows","Products_ES_T-Shirts","Products_ES_Tank-Tops","Products_ES_V-Necks","Products_ES_V-Long_Sleeves","Products_ES_Sweetshirts","Products_ES_Hoodies","Products_ES_Tumblers","Products_ES_Throw_Pillows","Products_FR_T-Shirts","Products_FR_Tank-Tops","Products_FR_V-Necks","Products_FR_V-Long_Sleeves","Products_FR_Sweetshirts","Products_FR_Hoodies","Products_FR_Tumblers","Products_FR_Throw_Pillows","Products_IT_T-Shirts","Products_IT_Tank-Tops","Products_IT_V-Necks","Products_IT_V-Long_Sleeves","Products_IT_Sweetshirts","Products_IT_Hoodies","Products_IT_Tumblers","Products_IT_Throw_Pillows","Products_UK_T-Shirts","Products_UK_Tank-Tops","Products_UK_V-Necks","Products_UK_V-Long_Sleeves","Products_UK_Sweetshirts","Products_UK_Hoodies","Products_UK_Tumblers","Products_UK_Throw_Pillows","Auto_Load_More","Auto_Winners","UI_Settings"])}),chrome.runtime.onInstalled.addListener(e=>{"install"===e.reason&&async function(e){try{await fetch(e,{method:"HEAD",mode:"no-cors"}),chrome.tabs.create({url:e})}catch{const e="https://easy-merch-research.blogspot.com/";chrome.tabs.create({url:e})}}("http://www.easymerchresearch.com/")});let e=null;const t="UserDataDB",s=(e,t)=>{(e=indexedDB.open(e,5)).onupgradeneeded=e=>{const s=e.target.result;t.forEach(e=>{s.objectStoreNames.contains(e)||s.createObjectStore(e,{keyPath:"asin"}).createIndex("asin","asin",{unique:!0})})},e.onerror=()=>{},e.onsuccess=e=>{e.target.result.close()}},o=async t=>e||new Promise((s,o)=>{const a=indexedDB.open(t);a.onerror=e=>{o(`Error opening database: ${e.target.errorCode}`)},a.onsuccess=t=>{e=t.target.result,s(e)}}),a=["key","lastCheck"];async function r(e,s){const a=(await o(t)).transaction([s],"readwrite").objectStore(s);try{const t=e.map(e=>new Promise((t,s)=>{const o=a.get(e.asin);o.onsuccess=()=>{const o=a.put(e);o.onsuccess=()=>{t({status:"success"})},o.onerror=()=>{s({status:"failed"})}},o.onerror=()=>{s({status:"failed"})}}));return await Promise.all(t),{status:"success"}}catch(a){return{status:"failed",error:a.message}}}async function n(e){return new Promise(async(s,a)=>{var r=(await o(t)).transaction([e],"readwrite").objectStore(e);const n=r.count();n.onsuccess=()=>{n.result&&0!==n.result||s({status:"noRecords"})},(r=r.clear()).onsuccess=()=>{s({status:"success"})},r.onerror=e=>{a({status:"failed",message:e.target.error})}})}async function c(e,t){await chrome.storage.local.set({key:e,lastCheck:t})}async function i(){const{key:e,lastCheck:t}=await async function(){const e=await chrome.storage.local.get(a);return{key:e.key||null,lastCheck:e.lastCheck||null}}();if(!e||"string"!=typeof e||5>e.length)return[!1,l("lna")];if(!t||function(e){if(!e)return!0;const t=new Date(e);return 24<=(new Date-t)/36e5}(t)){const t=await async function(e){try{const t=await fetch("https://api.gumroad.com/v2/licenses/verify",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({product_id:"M26frQ91wqQxtYDshuf0hQ==",license_key:e})});return t.ok?await t.json():{success:!1}}catch(e){return{success:!1,message:e.message}}}(e);if(!t.success)return[!1,l("lcf")];const{subscription_ended_at:s,subscription_cancelled_at:o,subscription_failed_at:a,refunded:r,email:n}=t.purchase??{};return n?s||o||a||r?[!1,l("lna")]:(await c(e,(new Date).toISOString()),[!0,l("lv")]):[!1,`${n} Not Supported!`]}return[!0,l("lvr")]}const d={lna:"License key is not active!",lcf:"Failed to check license key!",lv:"License key is valid.",lvr:"License already validated recently.",lns:"Not Supported!",ue:"An unknown error occurred."};function l(e,t=""){const s=d[e]||d.ue;return t?`${t} ${s}`:s}const u={us:{name:"US",domain:"https://www.amazon.com/",products:{tshirt:{name:"T-Shirts",rh:"&rh=p_6%3AATVPDKIKX0DER",code:"&hidden-keywords=Lightweight%2C+Classic+fit%2C+Double-needle+sleeve+and+bottom+hem+-Longsleeve+-Raglan+-Vneck+-Tanktop+",category:"&i=fashion-novelty"},tanktop:{name:"Tank-Tops",rh:"&rh=p_6%3AATVPDKIKX0DER",code:'&hidden-keywords=Tanktop+-Longsleeve+"tank+top"',category:"&i=fashion-novelty"},vneck:{name:"V-Necks",rh:"&rh=p_6%3AATVPDKIKX0DER",code:"&hidden-keywords=%22V-Neck+T-Shirt%22+++%22Lightweight%2C+Classic+fit%2C+Double-needle+sleeve+and+bottom+hem%22+",category:"&i=fashion-novelty"},sweatshirt:{name:"Sweatshirts",rh:"&rh=p_6%3AATVPDKIKX0DER",code:'&hidden-keywords="8.5+oz%2C+Classic+fit%2C+Twill-taped+neck"+"sweatshirt"+-hoodie+',category:"&i=fashion-novelty"},hoodie:{name:"Hoodies",rh:"&rh=p_6%3AATVPDKIKX0DER",code:"&hidden-keywords=8.5+oz%2C+Classic+fit%2C+Twill-taped+neck+hoodie+",category:"&i=fashion-novelty"},longsleeve:{name:"Long Sleeves",rh:"&rh=p_6%3AATVPDKIKX0DER",code:'&hidden-keywords=Lightweight%2C+Classic+fit%2C+Double-needle+sleeve+and+bottom+hem+-v-neck+-Raglan+-Vneck+-Tanktop+-hoodie+"long+sleeve+t-shirt"+',category:"&i=fashion-novelty"},phones:{name:"Phone Cases",rh:"&rh=p_6%3AATVPDKIKX0DER",code:"&hidden-keywords=Two-part+protective+case+made+from+a+premium+scratch-resistant+polycarbonate+shell+and+shock+absorbent+TPU+liner+protects+against+drops+",category:"&i=mobile"},tumbler:{name:"Tumblers",rh:"&rh=n%3A16310091%2Cp_6%3AATVPDKIKX0DER",code:"&hidden-keywords=Dual+wall+insulated%3A+keeps+beverages+hot+or+cold+Stainless+Steel%2C+BPA+Free+Leak+proof+lid+with+clear+slider+",category:"&i=garden"},mugs:{name:"Ceramic Mugs",rh:"&rh=p_6%3AATVPDKIKX0DER",code:"&hidden-keywords=11-ounce+ceramic+mug+is+dishwasher+and+microwave-safe%2C+lead+and+BPA+free+Features+glossy+finish+with+accent+colors+on+interior%2C+handle%2C+and+rim+of+two-tone+designs+",category:"&i=garden"},throwpillow:{name:"Throw Pillows",rh:"&rh=n%3A1063252%2Cp_6%3AATVPDKIKX0DER",code:"&hidden-keywords=100%25+spun-polyester+fabric+Double-sided+print+Filled+with+100%25+polyester+and+sewn+closed+Individually+cut+and+sewn+by+hand+Spot+clean%2Fdry+clean+only+",category:"&i=garden"},allproducts:{name:"All Products",rh:"&rh=p_6%3AATVPDKIKX0DER",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion-novelty"},menshirts:{name:"Men's Shirts",rh:"&rh=n%3A9056986011%2Cp_6%3AATVPDKIKX0DER",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion-novelty"},womanshirts:{name:"Women's Shirts",rh:"&rh=n%3A9056922011%2Cp_6%3AATVPDKIKX0DER",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion-novelty"},girlshirts:{name:"Girls' Shirts",rh:"&rh=n%3A9057039011%2Cp_6%3AATVPDKIKX0DER",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion-novelty"},boyshirts:{name:"Boys' Shirts",rh:"&rh=n%3A9057093011%2Cp_6%3AATVPDKIKX0DER",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion-novelty"},noveltymore:{name:"Novelty Clothing More",rh:"&rh=n%3A7141123011%2Cn%3A7147445011%2Cn%3A12035955011%2Cp_6%3AATVPDKIKX0DER&dc&c=ts",code:"&hidden-keywords=+",category:"&i=fashion-novelty"}},sortCode:{featured:{name:"Featured",code:"&s=featured"},reviews:{name:"Reviews",code:"&s=review-rank"},bestsellers:{name:"Best Sellers",code:"&s=exact-aware-popularity-rank"},newest:{name:"Newest Arrivals",code:"&s=date-desc-rank&ref=sr_st_date-desc-rank"},reviewscount:{name:"Reviews Counts",code:"&s=review-count-rank"},pricelowtohigh:{name:"Price: Low to high",code:"&s=price-asc-rank&dc"},pricehightolow:{name:"Price: High to low",code:"&s=price-desc-rank&dc"}},recentCode:{defaultvalue:{name:"All",code:""},last30days:{name:"Last 30 Days",code:"%2Cp_n_date_first_available_absolute%3A15196852011"},last90days:{name:"Last 90 Days",code:"%2Cp_n_date_first_available_absolute%3A15196853011"}}},de:{name:"DE",domain:"https://www.amazon.de/",products:{tshirt:{name:"T-Shirts",rh:"&rh=n%2Cp_6%3AA3JWKAKR8XB7XF",code:"&hidden-keywords=%22Unifarben%3A+100%25+Baumwolle%3B+Grau+meliert%22+Alle+anderen+melierten+Farben+-Langarmshirt+",category:"&i=fashion"},tanktop:{name:"Tank-Tops",rh:"&rh=n%2Cp_6%3AA3JWKAKR8XB7XF",code:"&hidden-keywords=leichtes%2C+klassisch+geschnittenes+Tank+Top%2C+doppelt+gen%C3%A4hte+%C3%84rmel+und+Saumabschluss+",category:"&i=fashion"},vneck:{name:"V-Necks",rh:"&rh=n%2Cp_6%3AA3JWKAKR8XB7XF",code:"&hidden-keywords=leichtes%2C+klassisch+geschnittenes+T-Shirt%2C+doppelt+gen%C3%A4hte+%C3%84rmel+und+Saumabschluss+%22v-ausschnitt%22+",category:"&i=fashion"},hoodie:{name:"Hoodies",rh:"&rh=n%2Cp_6%3AA3JWKAKR8XB7XF",code:"&hidden-keywords=8.5 oz, Klassisch geschnitten, doppelt genähter Saum+",category:"&i=fashion"},phones:{name:"Phone Cases",rh:"&rh=p_6%3AA3JWKAKR8XB7XF",code:"&hidden-keywords=Die+zweiteilige+Schutzhülle+aus+einer+hochwertigen%2C+kratzfesten+Polycarbonatschale+und+einer+stoßdämpfenden+TPU-Auskleidung+schützt+vor+Stürzen+",category:"&i=electronics"},allproducts:{name:"All Products",rh:"&rh=n%2Cp_6%3AA3JWKAKR8XB7XF",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion"}},sortCode:{featured:{name:"Featured",code:"&s=featured"},reviews:{name:"Reviews",code:"&s=review-rank"},reviewscount:{name:"Reviews Counts",code:"&s=review-count-rank"},bestsellers:{name:"Best Sellers",code:"&s=exact-aware-popularity-rank"},newest:{name:"Newest Arrivals",code:"&s=date-desc-rank&ref=sr_st_date-desc-rank"},pricelowtohigh:{name:"Price: Low to high",code:"&s=price-asc-rank&dc"},pricehightolow:{name:"Price: High to low",code:"&s=price-desc-rank&dc"}},recentCode:{defaultvalue:{name:"All",code:""},last7days:{name:"Last 7 Days",code:"%2Cp_n_date_first_available_absolute%3A13827500031"},last30days:{name:"Last 30 Days",code:"%2Cp_n_date_first_available_absolute%3A13827501031"},last90days:{name:"Last 90 Days",code:"%2Cp_n_date_first_available_absolute%3A13827502031"}}},uk:{name:"UK",domain:"https://www.amazon.co.uk/",products:{tshirt:{name:"T-Shirts",rh:"&rh=n%2Cp_6%3AA3P5ROKL5A1OLE",code:"&hidden-keywords=Lightweight%2C+Classic+fit%2C+Double-needle+sleeve+and+bottom+hem+-Longsleeve+-Raglan+-Vneck+-Tanktop+Solid+colors%3A+100%25+Cotton%3B+Heather+Grey%3A+90%25+Cotton%2C+10%25+Polyester%3B+All+Other+Heathers%3A+",category:"&i=fashion"},tanktop:{name:"Tank-Tops",rh:"&rh=n%2Cp_6%3AA3P5ROKL5A1OLE",code:'&hidden-keywords=Lightweight%2C+Classic+fit%2C+Double-needle+sleeve+and+bottom+hem+"tank+top"+',category:"&i=fashion"},vneck:{name:"V-Necks",rh:"&rh=n%2Cp_6%3AA3P5ROKL5A1OLE",code:'&hidden-keywords=Lightweight%2C%20Classic%20fit%2C%20Double-needle%20sleeve%20and%20bottom%20hem+"v-neck"+',category:"&i=fashion"},hoodie:{name:"Hoodies",rh:"&rh=n%2Cp_6%3AA3P5ROKL5A1OLE",code:'&hidden-keywords=Solid+colors%3A+80%25+Cotton%2C+20%25+Polyester%3B+Heather+Grey%3A+78%25+Cotton%2C+22%25+Poly%3B+Dark+Heather%3A+50%25+Cotton%2C+50%25+Polyester+"hoodie"',category:"&i=fashion"},phones:{name:"Phone Cases",rh:"&rh=p_6%3AA3P5ROKL5A1OLE",code:"&hidden-keywords=Two-part+protective+case+made+from+a+premium+scratch-resistant+polycarbonate+shell+and+shock+absorbent+TPU+liner+protects+against+drops+",category:"&i=electronics"},allproducts:{name:"All Products",rh:"&rh=n%2Cp_6%3AA3P5ROKL5A1OLE",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion"}},sortCode:{featured:{name:"Featured",code:"&s=featured"},reviews:{name:"Reviews",code:"&s=review-rank"},bestsellers:{name:"Best Sellers",code:"&s=exact-aware-popularity-rank"},newest:{name:"Newest Arrivals",code:"&s=date-desc-rank&ref=sr_st_date-desc-rank"},reviewscount:{name:"Reviews Counts",code:"&s=review-count-rank"},pricelowtohigh:{name:"Price: Low to high",code:"&s=price-asc-rank&dc"},pricehightolow:{name:"Price: High to low",code:"&s=price-desc-rank&dc"}},recentCode:{defaultvalue:{name:"All",code:""},last7days:{name:"Last 7 Days",code:"%2Cp_n_date_first_available_absolute%3A13827688031"},last30days:{name:"Last 30 days",code:"%2Cp_n_date_first_available_absolute%3A419164031"},last90days:{name:"Last 90 days",code:"%2Cp_n_date_first_available_absolute%3A419165031"}}},es:{name:"ES",domain:"https://www.amazon.es/",products:{tshirt:{name:"T-Shirts",rh:"&rh=n%2Cp_6%3AA1AT7YVPFBWXBL",code:'&hidden-keywords="+Color+solido%3A+100%25+Algodon%3B+Gris%3A+90%25+Algodon%2C+10%25+Poliester%3B+otros+colores%3A+50%25+Algodon%2C+50%25+Poliester"+"Ligero%2C+Encaje+clasico%2C+Manga+de+doble+puntada+y+bastilla+baja"+-sinmangas+-Longsleeve+-Raglan+-Vneck+-Tanktop+-CuelloV+',category:"&i=fashion"},tanktop:{name:"Tank-Tops",rh:"&rh=n%2Cp_6%3AA1AT7YVPFBWXBL",code:"&hidden-keywords=%22Colores+solidos%3A+100%25+Algodon%2C+Gris+Jaspeado%3A+90%25+Algodon%2C+10%25+Poliester%2C+Otros+Jaspeados+y+neones%3A+50%25+Algodon%2C+50%25+Poliester%22+",category:"&i=fashion"},vneck:{name:"V-Necks",rh:"&rh=n%2Cp_6%3AA1AT7YVPFBWXBL",code:"&hidden-keywords=%22Colores+solidos%3A+100%25+Algodon%2C+Gris+Jaspeado%3A+90%25+Algodon%2C+10%25+Poliester%2C+Otros+Jaspeados%3A+50%25+Algodon%2C+50%25+Poliester%22+-Raglan+",category:"&i=fashion"},hoodie:{name:"Hoodies",rh:"&rh=n%2Cp_6%3AA1AT7YVPFBWXBL",code:'&hidden-keywords="241+gr%2C+Encaje+clasico%2C+Cinta+de+sarga+en+el+cuello"+"Sudadera+con+Capucha"+',category:"&i=fashion"},phones:{name:"Phone Cases",rh:"&rh=p_6%3AA1AT7YVPFBWXBL",code:"&hidden-keywords=Funda+protectora+de+dos+piezas+fabricada+con+una+carcasa+de+policarbonato+de+primera+calidad+resistente+a+los+arañazos+y+un+revestimiento+de+TPU+amortiguador+que+protege+contra+las+caídas+",category:"&i=electronics"},allproducts:{name:"All Products",rh:"&rh=n%2Cp_6%3AA1AT7YVPFBWXBL",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion"}},sortCode:{featured:{name:"Featured",code:"&s=featured"},reviews:{name:"Reviews",code:"&s=review-rank"},bestsellers:{name:"Best Sellers",code:"&s=exact-aware-popularity-rank"},newest:{name:"Newest Arrivals",code:"&s=date-desc-rank&ref=sr_st_date-desc-rank"},reviewscount:{name:"Reviews Counts",code:"&s=review-count-rank"},pricelowtohigh:{name:"Price: Low to high",code:"&s=price-asc-rank&dc"},pricehightolow:{name:"Price: High to low",code:"&s=price-desc-rank&dc"}},recentCode:{defaultvalue:{name:"All",code:""},last7days:{name:"Last 7 days",code:"%2Cp_n_date_first_available_absolute%3A13827712031"},last30days:{name:"Last 30 days",code:"%2Cp_n_date_first_available_absolute%3A831288031"},last90days:{name:"Last 90 days",code:"%2Cp_n_date_first_available_absolute%3A831289031"}}},fr:{name:"FR",domain:"https://www.amazon.fr/",products:{tshirt:{name:"T-Shirts",rh:"&rh=n%2Cp_6%3AA1X6FK5RDHNB96",code:'&hidden-keywords="+Couleurs+unies%3A+100%25+Coton%3B+Gris+chiné%3A+90%25+Coton%2C+10%25+Polyester%3B+Autres+couleurs+chinées%3A+50%25+Coton%2C+50%25+Polyester"+%2BT-Shirt+-Col+-Raglan+',category:"&i=fashion"},tanktop:{name:"Tank-Tops",rh:"&rh=n%2Cp_6%3AA1X6FK5RDHNB96",code:"&hidden-keywords=Couleurs+unies%3A+100%25+Coton%3B+Gris+chiné%3A+90%25+Coton%2C+10%25+Polyester%3B+Autres+couleurs+chinées%3A+50%25+Coton%2C+50%25+Polyester+Débardeur+",category:"&i=fashion"},vneck:{name:"V-Necks",rh:"&rh=n%2Cp_6%3AA1X6FK5RDHNB96",code:"&hidden-keywords=Couleurs+unies%3A+100%25+Coton%3B+Gris+chiné%3A+90%25+Coton%2C+10%25+Polyester%3B+Autres+couleurs+chinées%3A+50%25+Coton%2C+50%25+Polyester+Shirt+-Débardeur+Col+",category:"&i=fashion"},hoodie:{name:"Hoodies",rh:"&rh=n%3A465094031%2Cp_6%3AA1X6FK5RDHNB96",code:"&hidden-keywords=+",category:"&i=fashion"},phones:{name:"Phone Cases",rh:"&rh=p_6%3AA1X6FK5RDHNB96",code:"&hidden-keywords=Coque+de+protection+en+deux+parties+composé+d%27une+coque+en+polycarbonate+de+première+qualité+résistant+aux+rayures+et+d%27une+doublure+en+TPU+absorbant+les+chocs+et+protégeant+contre+les+chutes+",category:"&i=electronics"},allproducts:{name:"All Products",rh:"&rh=n%2Cp_6%3AA1X6FK5RDHNB96",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion"}},sortCode:{featured:{name:"Featured",code:"&s=featured"},reviews:{name:"Reviews",code:"&s=review-rank"},bestsellers:{name:"Best Sellers",code:"&s=exact-aware-popularity-rank"},newest:{name:"Newest Arrivals",code:"&s=date-desc-rank&ref=sr_st_date-desc-rank"},reviewscount:{name:"Reviews Counts",code:"&s=review-count-rank"},pricelowtohigh:{name:"Price: Low to high",code:"&s=price-asc-rank&dc"},pricehightolow:{name:"Price: High to low",code:"&s=price-desc-rank&dc"}},recentCode:{defaultvalue:{name:"All",code:""},last7days:{name:"Last 7 days",code:"%2Cp_n_date_first_available_absolute%3A13827696031"},last30days:{name:"Last 30 days",code:"%2Cp_n_date_first_available_absolute%3A13827697031"},last90days:{name:"Last 90 days",code:"%2Cp_n_date_first_available_absolute%3A13827698031"}}},it:{name:"IT",domain:"https://www.amazon.it/",products:{tshirt:{name:"T-Shirts",rh:"&rh=n%2Cp_6%3AA11IL2PNWYJU7H",code:'&hidden-keywords="+Leggera%2C+taglio+classico%2C+maniche+con+doppia+cucitura+e+orlo+inferiore+"+%2BMaglietta+-lunghe+-Raglan+-Canotta+',category:"&i=fashion"},tanktop:{name:"Tank-Tops",rh:"&rh=n%2Cp_6%3AA11IL2PNWYJU7H",code:"&hidden-keywords=Tinta+unita%3A+100%25+Cotone%3B+Grigio+cenere%3A+90%25+Cotone%2C+10%25+Poliestere%3B+Altri+toni%3A+50%25+Cotone%2C+50%25+Poliestere+%2BCanotta+",category:"&i=fashion"},vneck:{name:"V-Necks",rh:"&rh=n%2Cp_6%3AA11IL2PNWYJU7H",code:"&hidden-keywords=Tinta+unita%3A+100%25+Cotone%3B+Grigio+Cenere%3A+90%25+Cotone%2C+10%25+Poliestere%3B+Altri+Toni%3A+50%25+Cotone%2C+50%25+Poliestere+Maglietta+Collo+Scollo+a+V+",category:"&i=fashion"},hoodie:{name:"Hoodies",rh:"&rh=n%2Cp_6%3AA11IL2PNWYJU7H",code:"&hidden-keywords=Tinta+unita%3A+80%25+Cotone%2C+20%25+Poliestere%2C+Grigio+cenere%3A+78%25+Cotone%2C+22%25+Poly%2C+Grigio+scuro%3A+50%25+Cotone%2C+50%25+Poliestere%2C+Felpa+con+Cappuccio+",category:"&i=fashion"},phones:{name:"Phone Cases",rh:"&rh=p_6%3AA11IL2PNWYJU7H",code:"&hidden-keywords=Custodia+protettiva+pieghevole%2C+in+stile+portafoglio%2C+fatta+da+policarbonato+antigraffio+di+alta+qualità+ed+un+rivestimento+in+TPU+assorbente+agli+urti.+Attutisce+i+colpi+e+protegge+da+cadute+accidentali+",category:"&i=electronics"},allproducts:{name:"All Products",rh:"&rh=n%2Cp_6%3AA11IL2PNWYJU7H",code:"&hidden-keywords=Solid+colors+Cotton+Heather+Grey+Cotton+Polyester+All+Other+Heathers+Cotton+Polyester+",category:"&i=fashion"}},sortCode:{featured:{name:"Featured",code:"&s=featured"},reviews:{name:"Reviews",code:"&s=review-rank"},bestsellers:{name:"Best Sellers",code:"&s=exact-aware-popularity-rank"},newest:{name:"Newest Arrivals",code:"&s=date-desc-rank&ref=sr_st_date-desc-rank"},reviewscount:{name:"Reviews Counts",code:"&s=review-count-rank"},pricelowtohigh:{name:"Price: Low to high",code:"&s=price-asc-rank&dc"},pricehightolow:{name:"Price: High to low",code:"&s=price-desc-rank&dc"}},recentCode:{defaultvalue:{name:"All",code:""},last7days:{name:"Last 7 days",code:"%2Cp_n_date_first_available_absolute%3A13827471031"},last30days:{name:"Last 30 days",code:"%2Cp_n_date_first_available_absolute%3A490216031"},last90days:{name:"Last 90 days",code:"%2Cp_n_date_first_available_absolute%3A490217031"}}}},h=new Set;chrome.runtime.onStartup.addListener(()=>{chrome.storage.local.get("createdSortMenus",e=>{if(Array.isArray(e.createdSortMenus))for(const t of e.createdSortMenus)h.add(t)})}),chrome.runtime.onInstalled.addListener(()=>{chrome.storage.local.get("createdSortMenus",e=>{if(Array.isArray(e.createdSortMenus))for(const t of e.createdSortMenus)h.add(t);chrome.contextMenus.removeAll(()=>{for(const e in u){const t=u[e];chrome.contextMenus.create({id:`market_${e}`,title:t.name,contexts:["all"]});for(const s in t.products){const o=t.products[s];if(chrome.contextMenus.create({id:`product_${e}_${s}`,parentId:`market_${e}`,title:o.name,contexts:["all"]}),h.has(`${e}_${s}`)){const t=u[e];t.products[s];for(const o in t.sortCode){const a=t.sortCode[o];if(chrome.contextMenus.create({id:`sortCode_${e}_${s}_${o}`,parentId:`product_${e}_${s}`,title:a.name,contexts:["all"]}),t.recentCode)for(const a in t.recentCode){const r=t.recentCode[a];r&&"string"==typeof r.name&&chrome.contextMenus.create({id:`recentCode_${e}_${s}_${o}_${a}`,parentId:`sortCode_${e}_${s}_${o}`,title:r.name,contexts:["all"]})}}}else chrome.contextMenus.create({id:`loadSorts_${e}_${s}`,parentId:`product_${e}_${s}`,title:"▶ Click to load options...",contexts:["all"]})}}})})}),chrome.contextMenus.onClicked.addListener((e,t)=>{if(!e.menuItemId.startsWith("loadSorts_"))return;const[,s,o]=e.menuItemId.split("_"),a=`${s}_${o}`;if(h.has(a))return;const r=u[s];r.products[o];for(const e in r.sortCode){const t=r.sortCode[e];if(chrome.contextMenus.create({id:`sortCode_${s}_${o}_${e}`,parentId:`product_${s}_${o}`,title:t.name,contexts:["all"]}),r.recentCode)for(const t in r.recentCode){const a=r.recentCode[t];a&&"string"==typeof a.name&&chrome.contextMenus.create({id:`recentCode_${s}_${o}_${e}_${t}`,parentId:`sortCode_${s}_${o}_${e}`,title:a.name,contexts:["all"]})}}h.add(a),chrome.storage.local.set({createdSortMenus:Array.from(h)}),chrome.contextMenus.remove(e.menuItemId)}),chrome.contextMenus.onClicked.addListener(e=>{const t=e.menuItemId;if(!t.startsWith("recentCode_"))return;const[s,o,a,r,n]=t.split("_"),c=u[o],i=c.products?.[a],d=c.sortCode?.[r],l=c.recentCode?.[n];if(!(c&&i&&d&&l))return;const h=encodeURIComponent(e.selectionText?.trim()||""),m=`${c.domain}s?k=${h}`,_=i.category?`&i=${i.category}`:"",y=i.rh||"",w=d.code||"",p=`${m}${_}${y}${l.code||""}${w}${i.code||""}${i.options||""}`;chrome.tabs.create({url:p})});