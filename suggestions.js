!async function(){if(await new Promise((a,b)=>{chrome.runtime.sendMessage({action:"gls"},e=>chrome.runtime.lastError?b(new Error(chrome.runtime.lastError.message)):void a(e?.active||!1))})){let e=document.querySelector(".search-inputsss");e&&(e.value="N.I.T.W.I.F")}const e=[""];let t,n=new Set;const o=document.getElementById("searchTerm");let s=(a=document.getElementById("randomText")?.innerText||"",a.split(" ").filter((a,b,e)=>2<=a.length&&e.indexOf(a)===b).join(" ")).replace(/[^a-zA-Z]+/g," ");var a;const i={us:{name:"US",domain:"https://www.amazon.com/",suggestions:{marketId:"ATVPDKIKX0DER",market:"amazon.com",API_URL:"https://completion.amazon.com/api/2017/suggestions",siteVariant:"desktop",alias:"aps"}},de:{name:"DE",domain:"https://www.amazon.de/",suggestions:{marketId:"A1PA6795UKMFR9",market:"amazon.de",API_URL:"https://completion.amazon.de/api/2017/suggestions",siteVariant:"desktop",alias:"aps"}},uk:{name:"UK",domain:"https://www.amazon.co.uk/",suggestions:{marketId:"A1F83G8C2ARO7P",market:"amazon.co.uk",API_URL:"https://completion.amazon.co.uk/api/2017/suggestions",siteVariant:"desktop",alias:"aps"}},es:{name:"ES",domain:"https://www.amazon.es/",suggestions:{marketId:"A1RKKUPIHCS9HS",market:"amazon.es",API_URL:"https://completion.amazon.es/api/2017/suggestions",siteVariant:"desktop",alias:"aps"}},fr:{name:"FR",domain:"https://www.amazon.fr/",suggestions:{marketId:"A13V1IB3VIYZZH",market:"amazon.fr",API_URL:"https://completion.amazon.fr/api/2017/suggestions",siteVariant:"desktop",alias:"aps"}},it:{name:"IT",domain:"https://www.amazon.it/",suggestions:{marketId:"APJ6JRA9NG5V4",market:"amazon.it",API_URL:"https://completion.amazon.it/api/2017/suggestions",siteVariant:"desktop",alias:"aps"}}};o.addEventListener("input",async a=>{const b=a.target.value;if(clearTimeout(t),""===b||" "===b){const a=document.querySelector("#keywords-list");return a&&(a.innerHTML=""),void n.clear()}t=setTimeout(async()=>{const a=document.getElementById("cmarket").value.toLowerCase(),t=r(a,b.trim(),e);await m(t)},1500)});const r=(a,b,e)=>{const t=parseInt(document.getElementById("maxKeys").value||100),n=s.split(" "),o=i[a];if(!i[a])return[];const r=[],{suggestions:m}=i[a],c=document.querySelector("#additional-keywords")?.checked,d=["","a","b","c","d","e","f","g","h","i","j","k","g","l","m","n","o","p","q","r","s","t","u","v","w","y"];if(("us"==o||"uk"==o)&&d.push("with","and","after","before"),c&&!0===c)e.forEach(a=>{for(let e of d){const t=b.trim().includes("shirt"),n=` ${e} ${b.toLowerCase().replace("shirt","").trim()} ${t?"shirt":""}`,o=[`mid=${encodeURIComponent(m.marketId)}`,`alias=${encodeURIComponent(m.alias)}`,`prefix=${encodeURIComponent(` ${n.trim()} `)}`,`suffix=${encodeURIComponent(a.trim())}`,`site-variant=${encodeURIComponent(m.siteVariant)}`],s=`${m.API_URL}?${o.join("&")}`;r.push(s);const i=[`mid=${encodeURIComponent(m.marketId)}`,`alias=${encodeURIComponent(m.alias)}`,`prefix=${encodeURIComponent(" ")}`,`suffix=${encodeURIComponent(`${n.trim()}`)}`,`site-variant=${encodeURIComponent(m.siteVariant)}`],c=`${m.API_URL}?${i.join("&")}`;r.push(c)}});else{const a=[`mid=${encodeURIComponent(m.marketId)}`,`alias=${encodeURIComponent(m.alias)}`,`prefix=${encodeURIComponent(` ${b.trim()} `)}`,`suffix=${encodeURIComponent("")}`,`site-variant=${encodeURIComponent(m.siteVariant)}`],e=`${m.API_URL}?${a.join("&")}`;r.push(e);for(let a=0;a<t;a++){const e=` ${n[Math.floor(Math.random()*n.length)]} ${b.trim().includes("shirt")?"shirt":""} `,t=[`mid=${encodeURIComponent(m.marketId)}`,`alias=${encodeURIComponent(m.alias)}`,`prefix=${encodeURIComponent(` ${e.trim()} `)}`,`suffix=${encodeURIComponent("")}`,`site-variant=${encodeURIComponent(m.siteVariant)}`],o=`${m.API_URL}?${t.join("&")}`;r.push(o);const s=[`mid=${encodeURIComponent(m.marketId)}`,`alias=${encodeURIComponent(m.alias)}`,`prefix=${encodeURIComponent(" ")}`,`suffix=${encodeURIComponent(`${e.trim()}`)}`,`site-variant=${encodeURIComponent(m.siteVariant)}`],i=`${m.API_URL}?${s.join("&")}`;r.push(i)}}return r},m=async a=>{const b=new Set;for(const e of a)try{const a=await new Promise((a,b)=>{chrome.runtime.sendMessage({action:"fetchAmazonData",url:e,mode:0},e=>{e?.success&&Array.isArray(e.data?.suggestions)?a(e.data):b(e?.error||"Invalid response format")})});a.suggestions.filter(a=>3<a.value.length).forEach(a=>b.add(a.value))}catch(a){}b.forEach(c)};function c(a){const b=document.querySelector("#keywords-list");if(![...b.children].some(b=>b.textContent.trim().startsWith(a))){const e=document.createElement("li");e.innerHTML=`${a} <svg fill="currentColor" class='custom-eye' height="16" style="margin-left: 4px;" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M14 3h7v7h-2V6.414l-8.293 8.293-1.414-1.414L17.586 5H14V3zM5 5h6V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-6h-2v6H5V5z"></path></svg><i class="fa fa-copy"></i><i class="fa fa-trash-alt"></i>`,b.appendChild(e)}}function d(a){const b=a.split(/\s+/).map(a=>a.trim()),e=new Set;b.forEach(a=>e.add(a));for(let t=0;t<b.length;t++)for(let a=t+1;a<b.length;a++)e.add(b.slice(t,a+1).join(" "));return[...e]}async function l(a){return new Promise((b,e)=>{chrome.runtime.sendMessage({action:"fetchAmazonData",url:a},a=>{a.success?b(a.data.suggestions.map(a=>a.value)):e(a.error)})})}document.getElementById("delete-all").addEventListener("click",()=>{document.querySelector("#keywords-list").innerHTML=""}),document.getElementById("copy-all").addEventListener("click",()=>{const b=[...document.querySelector("#keywords-list").children].map(a=>a.textContent.trim());if(0<b.length){const a=b.join("\n");navigator.clipboard.writeText(a).then(()=>{alert("All suggestions have been copied!")}).catch(()=>{})}else alert("No suggestions to copy!")}),document.querySelector("#keywords-list").addEventListener("click",a=>{if(a.target.classList.contains("fa-copy")){const b=a.target.parentElement.textContent.trim();navigator.clipboard.writeText(b).then(()=>{}).catch(()=>{})}else if(a.target.classList.contains("fa-trash-alt")){const b=a.target.parentElement,e=b.textContent.trim();b.remove(),n.delete(e)}else if(a.target.classList.contains("custom-eye")){const b=a.target.parentElement?.textContent?.trim(),e=document.getElementById("cmarket").value.toLowerCase();if(i[e]&&i[e].domain){const a=encodeURIComponent(b),t=`${i[e].domain}/s?k=${a}`;window.open(t,"_blank")}}}),document.getElementById("analyze").addEventListener("click",async function(){var a="ATVPDKIKX0DER",b="com";const e=document.getElementById("cmarket").value.toLowerCase(),t={us:{mid:"ATVPDKIKX0DER",region:"com"},uk:{mid:"A1F83G8C2ARO7P",region:"co.uk"},de:{mid:"A1PA6795UKMFR9",region:"de"},fr:{mid:"A13V1IB3VIYZZH",region:"fr"},it:{mid:"APJ6JRA9NG5V4",region:"it"},es:{mid:"A1RKKUPIHCS9HS",region:"es"}};t[e]&&(a=t[e].mid,b=t[e].region);const n=document.getElementById("title").value,o=document.getElementById("brand").value;if(!n&&!o)return void alert("Please enter a title or brand!");const s=function(a){const{title:e,brand:t}=a,n=e?d(e.toLowerCase()):[],o=t?d(t.toLowerCase()):[];let s=[...new Set([...n,...o])];return e&&(e.toLowerCase().includes("shirt")||!1)&&(s=s.map(a=>a.includes("shirt")?a:`${a} shirt`)),s}({title:n,brand:o}),i=document.getElementById("results").querySelector("tbody");if(i){i.innerHTML="";for(const e of s){const t=`https://completion.amazon.${b}/api/2017/suggestions`,n=`?page-type=Gateway&lop=en_US&site-variant=desktop&client-info=amazon-search-ui&alias=aps&b2b=0&fresh=0&ks=66&suggestion-type=keyword&fb=1&mid=${a}&prefix=`,o=` ${e}`,s=[`${t}${n}+${encodeURIComponent(o)}&search_modifier_type=prepend&keyword_modifier=+&search_term=+${encodeURIComponent(o)}`,`${t}${n}${encodeURIComponent(o)}+&search_modifier_type=append&keyword_modifier=+&search_term=${encodeURIComponent(o)}+`,`${t}${n}${encodeURIComponent(o)}+&search_modifier_type=append&keyword_modifier=+&search_term=${encodeURIComponent(o)}+&search-alias=fashion`,`${t}${n}+${encodeURIComponent(o)}+${encodeURIComponent(o)}&search_modifier_type=both&keyword_modifier=+&search_term=+${encodeURIComponent(o)}+${encodeURIComponent(o)}+`];try{const a=await Promise.all(s.map(a=>l(a))),b=document.createElement("tr"),t=document.createElement("td"),n=document.createElement("td");t.textContent=e;const o=document.createElement("ul");a.flat().forEach(a=>{const b=document.createElement("li");b.classList.add("suggestion"),b.textContent=a,o.appendChild(b)}),n.appendChild(o),b.appendChild(t),b.appendChild(n),i.appendChild(b)}catch(a){}}}})}();